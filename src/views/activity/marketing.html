<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <title>layui</title>
   <meta name="renderer" content="webkit">
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

   <link rel="stylesheet" href="../../../start/layui/css/layui.css">
    <link rel="stylesheet" href="../../../start/layui/css/modules/bootstrap.min.css">
    <script src="../../../start/layui/config_admin.js"></script>
    <script src="../../../start/layui/lay/modules/jquery-2.1.4.js"></script>
   <script src="../../../start/layui/layui.js"></script>
    <script src="../../../start/layui/lay/modules/bootstrap-treeview.js"></script>

    <style>
    .layui-table img{max-width:100%;}
    .layui-layer-dialog .layui-layer-content{padding:0 20px 0 0!important;}
</style>



</head>
<body>
<div class="layui-card">
    <div id="" class="layui-card-body" style="padding-top:10px;">
        <a href="http://localhost:63342/hyadmin/src/views/activity/addActive.html" class="layui-btn">增加</a>
        <button class="layui-btn layui-btn-danger">删除</button>
        <table lay-filter="toolbar" class="layui-hide" id="formTable"></table>
    </div>
</div>


<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="fabu">发布</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
    layui.use(['table','form','layer'],function(){
        var table = layui.table,
            layer = layui.layer,
            form = layui.form;

        table.render({
            elem: '#formTable',
            url:genAPI('/wxDev/sellactivity/getSellActivityListFenye'),
            method:'get',
            //where:'json',
           // minWidth:80,
            //cellMinWidth:60,
           // height: 'full-10',
            page: true,
            cols: [[
                {type:'numbers'},
                {type: 'checkbox'},
               /* {field:'id', title:'ID',align:'center',width:20},*/
                {field:'picname',align:'center', title:'图片',width:120, templet: '<div><img src="{{ d.fileRealPath}}"></div>',style:""},
                {field:'title',align:'center', title:'活动名称',},
                {field:'top',align:'center', title:'是否置顶',},
                {field:'opreate',align:'center', title:'操作',  toolbar: '#barDemo'},
            ]],
            request: {
                pageName: 'page', //页码的参数名称，默认：page
                limitName: 'limit' //每页数据量的参数名，默认：limit
            },
            response: {
                 statusName: 'code',//数据状态的字段名称，默认：code
                 statusCode: '00000', //成功的状态码，默认：0
                 msgName: 'msg', //状态信息的字段名称，默认：msg
                 countName: 'total',//数据总数的字段名称，默认：count
                 dataName: 'list' //数据列表的字段名称，默认：data
            },
            done: function(res, curr, count){
                console.log(res);
            }
        });
        table.on('tool(toolbar)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的DOM对象

            if(layEvent === 'fabu'){ //查看
                layer.open({
                    title: '发布',
                    area: ['800px', '500px'],
                    offset: 'auto',
                    maxWidth:'100%',
                    maxHeight :'100%',
                    content: '<div id="tree" style="height: 400px;width:165px;font-size:12px;overflow-y :scroll;float: left"></div>' +
                    '<div style="width:320px;font-size:12px;float: left;min-height:100%;">' +
                    '<table class="layui-table" id="idTest" lay-filter="idTest"></table></div>' +
                    '<div style="width:320px;font-size:12px;float: left"></div>',
                    success: function(layero, index){

                        console.log(layero, index);
                        $.ajax({
                            type:"get",
                            url : genAPI('wxDev/sellactivity/getDistrict'), // 请求的URL
                            dataType : 'json',
                            async : false,
                            cache : false,
                            success : function(res) {
                                console.info(res);
                                $('#tree').treeview({
                                    data: res.data,
                                    showBorder:false,
                                    levels:1,
                                    //backColor:'#f5f5f5',
                                    onhoverColor:'#6bbfb7',
                                    selectedBackColor:'#009688',
                                    onNodeSelected: function(event, data) {
                                        console.info(data);
                                        console.info(data.treeId);
                                        table.render({
                                            elem: '#idTest',
                                            method:'get',
                                            url: genAPI('wxDev/sellactivity/getKhListByTreeId'),
                                            where: {
                                                 treeId: data.treeId
                                            },
                                            cols: [[
                                                {type: 'checkbox'},
                                                {field:'khmc',align:'center', title:'客户名称'}
                                            ]],
                                            response: {
                                                statusName: 'code',//数据状态的字段名称，默认：code
                                                statusCode: '00000', //成功的状态码，默认：0
                                                msgName: 'msg', //状态信息的字段名称，默认：msg
                                                countName:'count',
                                                dataName: 'data' //数据列表的字段名称，默认：data
                                            },
                                            done: function(res, curr, count){
                                                console.log(res);
                                            }
                                        });

                                        /*table.reload('idTest', {
                                            method:'get',
                                            url: genAPI('wxDev/sellactivity/getKhListByTreeId'),
                                            where: {
                                                   treeId: data.treeId
                                                },
                                            response: {
                                                statusName: 'code',//数据状态的字段名称，默认：code
                                                statusCode: '00000', //成功的状态码，默认：0
                                                msgName: 'msg', //状态信息的字段名称，默认：msg
                                                //countName:'count',
                                                dataName: 'data' //数据列表的字段名称，默认：data
                                            }
                                        });*/
                                        //table.init();
                                    }
                                });
                            }
                        });
                    }
                 });
            } else if(layEvent === 'del'){ //删除
                layer.confirm('你确定要删除吗？', function(index){
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    //向服务端发送删除指令
                });
            } else if(layEvent === 'edit'){ //编辑
                //do something
                console.info(obj);
                //同步更新缓存对应的值
                obj.update({
                    username: '123'
                    ,title: 'xxx'
                });
            }
        });
        table.on('checkbox(toolbar)', function(obj){
            console.log(obj.checked); //当前是否选中状态
            console.log(obj.data); //选中行的相关数据
            console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
        });




    });

</script>

</body>
</html>